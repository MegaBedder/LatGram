funcion subproceso()
  hash = "status:".chat->id.":bienvenida"
  hash2 = "custom:".chat->id.":bienvenida"
  nombre_usuario = nuevo_usuario->usuario
  si ! nombre_usuario
    nombre_usuario = "(sin usuario)"
  fin
  bienvenida = redis->obtener(com, hash)
  bienvenida_custom = redis->obtener(com, hash2)
  si bienvenida == "on"
    si nuevo_usuario->id
      si bienvenida_custom
        mensaje = cadena->reemplazar(bienvenida_custom, "$usuario", acadena(nombre_usuario))
        mensaje = cadena->reemplazar(mensaje, "$id", acadena(nuevo_usuario->id))
        mensaje = cadena->reemplazar(mensaje, "$nombre", acadena(nuevo_usuario->nombre))
        mensaje = cadena->reemplazar(mensaje, "$titulo", acadena(chat->titulo))
      sino
        mensaje = "Bienvenido ".nuevo_usuario->nombre." a ".chat->titulo
      fin
        enviarMensaje(chat->id, mensaje, md)
        retornar "Nuevo miembro en ".chat->titulo."\nMiembro: ".nuevo_usuario->nombre." (".nuevo_usuario->id.")"
    fin
  fin
  hash = "custom:".chat->id.":comando"
  comando_nuevo = redis->hobtener(com, hash, msg->texto)
  si comando_nuevo
    enviarMensaje(chat->id, comando_nuevo, md)
    retorno "comando personalizado ejecutado"
  fin
  retornar falso
fin

funcion mensajes()
  si matches[1] == "id"
    enviarMensaje(chat->id, "*Chat ID*: ".chat->id.". *User ID*: ".usuario->id, md)
  fin
  si matches[1] == "start"
    ayuda = '{"inline_keyboard":[[{"text":"Programaci칩n Latino","url":"https://github.com/primitivorm/latino"},{"text":"Repositorio del Bot","url":"https://github.com/jarriztg/telegram-bot-latino"}]]}'
  	enviarTeclado(chat->id, "춰Hey! ".no_markdown(usuario->nombre)."\n\nEst치s probando el nuevo bot escrito completamente en la *programaci칩n Latino*. Por el momento faltan cosas. Pero de poco a poco ir치 mejorando 游땏游녨", ayuda, md)
  fin
  si matches[1] == "comando"
    hash = "custom:".chat->id.":comando"
    ok = enviarMensaje(chat->id, "*Nuevo comando*: !".matches[2]."\nResponde: ".matches[3], md)
    si ok
      redis->hasignar(com, hash, "!".matches[2], matches[3])
    sino
      enviarMensaje(chat->id, "*Error de markdown*", md)
    fin
  fin
  si matches[1] == "bienvenida"
    hash = "status:".chat->id.":bienvenida"
    hash2 = "custom:".chat->id.":bienvenida"
    estado = redis->obtener(com, hash)
    elegir(matches[2])
    caso "on":
      si estado == "on"
        enviarMensaje(chat->id, "La bienvenida *ya est치 activada*", md)
      sino
        redis->asignar(com, hash, matches[2])
        enviarMensaje(chat->id, "La bienvenida *activada*", md)
      fin
    caso "off":
      si estado == "off"
        enviarMensaje(chat->id, "La bienvenida *ya est치 desactivada*", md)
      sino
        redis->asignar(com, hash, matches[2])
        enviarMensaje(chat->id, "La bienvenida *desactivada*", md)
      fin
    defecto:
      ok = enviarMensaje(chat->id, "*Nueva bienvenida asignada*:\n".matches[2], md)
      si ! ok
        enviarMensaje(chat->id, "*El markdown est치 mal.*", md)
      sino
        redis->asignar(com, hash2, matches[2])
      fin
    fin
  fin
fin

comandos = [
	"^/(id)$",
  "^/(id)@".bot->usuario."$",
  "^/(start)$",
  "^/(start)@".bot->usuario."$",
  "^/(bienvenida) (.+)$",
  "^/(comando) !([a-Z]+) (.*)$",
	{
		"accion": mensajes,
    "subproceso": subproceso
	}
]
